<!DOCTYPE html>
<html lang="en">
<head>
  <title>Benchmarking ssh-agent performance</title>
  <meta name="description" content="Orange Sun | Posts | Vitaly Potyarkin | 2023-07-19">
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="origin">
  <meta name="generator" content="Pelican">
  <link href="https://potyarkin.ml/posts/2023/ssh-agent-benchmark/" rel="canonical">
<link href="https://potyarkin.ml/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Orange Sun Full Atom Feed" />
<link href="https://potyarkin.ml/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Orange Sun Full RSS Feed" />
  <link href="https://potyarkin.ml/theme/css/style.css?cache=ce1ce9e802f6452fc24c45dcd14f219b9fdbc4b78394fcb3ed490c23f88a6851" type="text/css" rel="stylesheet">
  <link href="https://potyarkin.ml/theme/css/fonts.css?cache=32c843bb3ce96eb9fb92f48c7a63dc133ab32e0d267a2e1453199c23403d5cd0" type="text/css" rel="stylesheet">
  <link href="https://potyarkin.ml/theme/css/codecolor/bleak.css?cache=4793611eaa86c9638927c57ac8d9995c5f7ca18d9ffed3721467cf3ef61b5e8e" type="text/css" rel="stylesheet">
    <link href="https://potyarkin.ml/static/custom.css?cache=e3963750b86fbc40a84ec4f04703361dd7c0b05acd171c3015a6d39c5477d664" type="text/css" rel="stylesheet">
  <style>
  :root {
    --accent-hue: 14.917127071823206;
    --accent-saturation: 87.43961352657004%;
    --accent-lightness: 59.411764705882355%;
    --accent-rgb: #f26a3d;
  }
  </style>
  <meta name="theme-color" content="#f26a3d">
</head>
<body class="pelican-article">
<nav id="menu">
  <a href="#" class="close button">Close</a>
  <a href="#menu" class="open button">Menu</a>
  <ul class="menu-list">
      <li><a href="/archive/">Archive</a></li>
      <li><a href="/tags/">Tags</a></li>
      <li><a href="mailto:sio.wtf@gmail.com">Email</a></li>
      <li><a href="https://github.com/sio">Github</a></li>
      <li><a href="/feeds/">feeds</a></li>
      <li><a href="/bookmarks/">bookmarks</a></li>
      <li><a href="https://potyarkin.ml/blogroll/">Blogroll</a></li>
      <li><a href="https://potyarkin.ml/webring/">Webring</a></li>
  </ul>
</nav>  <header class="page-header">
    <h1>Benchmarking ssh-agent performance</h1>
    <span class="subtitle"><a href="https://potyarkin.ml/">Orange Sun</a> |
<a href="https://potyarkin.ml/posts/">Posts</a> |   <a href="https://potyarkin.ml/">Vitaly Potyarkin</a>
| 2023-07-19
</span>
  </header>
<article class="full"><p>I have an application idea that would require calling ssh-agent rather
frequently - but how many requests per second can it handle?</p>
<p>To answer this question I wrote a <a href="https://github.com/sio/ssh-agent-benchmark/blob/master/ssh_agent_test.go">small benchmark</a> in Go.
It runs a tight loop sending messages for ssh-agent to sign.
Turns out the agent is pretty fast!</p>
<p>On a cheap cloud machine it was able to reliably sign more than 500 messages
per second with an ED25519 key. RSA signing was about 4-5 times slower, as
expected.
For a personal heuristic I've decided to remember that ED25519 signatures
cost 2ms and RSA ones 8ms.</p>
<p>Message size had little effect on throughput because both in ED25519 and in
RSA signatures inputs are hashed with a fast SHA algorithm prior to any other
processing.</p>
<p>Just in case my random number generator was too slow I checked if it affects
the benchmark results. Tests confirmed that it doesn't.</p>
<p>Of course, 500 rps does not sound <em>web scale</em> but for me it's more than
enough. OpenSSH ssh-agent utilizes only a single CPU core, so there is some
potential for performance improvement if you need - but that would mean
doing the signatures in your software. I would rather trust OpenSSH team
(who are known to be just the right amount of paranoid) than touch private key
material with my clumsy hands.</p>
<hr>
<p>You can run the same tests yourself: clone the <a href="https://github.com/sio/ssh-agent-benchmark">repo</a> and execute <code>make</code> from
top-level directory.
Benchmark names describe the key being used, message size and whether the
message is unique or the same for each iteration. Here is a sample output:</p>
<div class="highlight"><pre><span></span><code><span class="go">BenchmarkSshAgent/key_ed25519/32B/unique-4          3553      1763363 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/32B/same-4            3568      1708270 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/32B/unique-4           778      7824780 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/32B/same-4             763      7657785 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/64B/unique-4          3456      1752457 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/64B/same-4            3598      1733750 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/64B/unique-4           781      7639828 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/64B/same-4             798      7720210 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/256B/unique-4         3549      1735906 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/256B/same-4           3417      1722301 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/256B/unique-4          698      7738767 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/256B/same-4            787      7625366 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/1024B/unique-4        3555      1703601 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/1024B/same-4          3651      1633226 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/1024B/unique-4         805      7542115 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/1024B/same-4           810      7437307 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/16384B/unique-4       3205      1935190 ns/op</span>
<span class="go">BenchmarkSshAgent/key_ed25519/16384B/same-4         3296      1907921 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/16384B/unique-4        783      7624776 ns/op</span>
<span class="go">BenchmarkSshAgent/key_rsa4096/16384B/same-4          759      7620548 ns/op</span>
</code></pre></div></article>
<nav class="article-tags">
  <a href="https://potyarkin.ml/tags/ssh/">ssh</a>
  <a href="https://potyarkin.ml/tags/cryptography/">cryptography</a>
  <a href="https://potyarkin.ml/tags/benchmark/">benchmark</a>
  <a href="https://potyarkin.ml/tags/go/">go</a>
  <a href="https://potyarkin.ml/tags/ed25519/">ed25519</a>
</nav>
<nav class="neighbors">
  <a class="neighbor neighbor-prev" href="https://potyarkin.ml/posts/2023/excel-many-to-many/">
    <h1>Many-to-many relationships in Excel data model</h1>
    <p>This is a quick hack to build many-to-many relationships in Excel data model even...</p>
  </a>
  <span class="neighbor"></span>
</nav>
<footer class="page-footer">
  <section class="credits">
        <span class="credits-left">
          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a>
        </span>
        <span class="credits-center">
          <a href="https://potyarkin.ml/">Orange Sun</a>
        </span>
        <span class="credits-right">
          Theme <a href="https://github.com/sio/pelican-smallweb" rel="nofollow">SmallWeb</a>
        </span>
  </section>
</footer></body>
</html>